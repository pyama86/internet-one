---

### 2017新卒研修
### Internet技術的なあれ
### (@pyama86)

<span style="color:gray">秋の訪れと、夏への別れ、痩せたい</span>

---

### 僕について
- 鹿児島生まれ、鹿児島育ち
- 31歳独身、今年の目標は第1子爆誕
- キャリア
 1. 社内SE
 1. ISPのサーバエンジニア
 1. ムームードメイン
 1. ホスのテックリード
- 好きな食べ物
 - 鶏の唐揚げ
 - 雲仙ハム

---

### 今日話すこと

1. IPルーティング
1. DNS

---

### IP

172.17.10.10/24

---

### Subnet

172.17.10.10/__24__

---

### Subnet

![subnet](http://www.infraexpert.com/studygif/ip18.gif)

---

### Subnet

Subnetで決まること

- どのネットワークに属しているか
- ホストアドレスの範囲
- ネットワークアドレス
- ブロードキャストアドレス

---

### Subnet
#### ネットワークアドレス
ネットワークを表わすアドレス。通常表記のみに使われる

#### ブロードキャストアドレス
ホスト部が全て1のアドレス。すべての同じネットワークのホストに到達する通信を行える

---

### Subnet
下記のアドレスの、ネットワークアドレス、ブロードキャストアドレス、ホストアドレスの個数を答えよ(制限時間:180000ms)

192.168.10.0/19

---

### Subnet
下記のアドレスは同じネットワークに所属しているか？(制限時間:120000ms)

- 10.0.1.10/23
- 10.0.3.10/23

---

### ARP

ホスト同士の通信はL2層の解決を行ってから実行される。L2層の名前解決プロトコルがARP

---

### ARP
```
$ arp -an
```

---

```
$ ping -c 1 8.8.8.8
$ arp -an
```

なぜ8.8.8.8のARPは解決されないのか？

> TODO  メガネで長身で、金遣いの荒そうな人に当てる

---

### IP Routing

IPルーティングは複数のネットワークに所属するホストがパケットを中継する仕組み。

---

### IP Routing

> TODO その時、僕から見て一番右の人に家のNW図を書いてもらう(想像可)

> 書いてもらった図はあとから使うので消さない用に誰か覚えててほしい

---

### IP Routing

> TODO 一通りDISったあと、考察し、NW図を書く

---

### IP Routing

> TODO デフォルトゲートウェイの話をここまでして無ければする

---

### IP Routing

あるネットワークに対して、デフォルトゲートウェイ以外にパケットを送りたい場合はスタティックルートを定義することが出来る。

![static route](http://image.itmedia.co.jp/ait/articles/0908/14/r3ccnatai22_03.gif)

```
$ route add -net 192.168.3.0/24 192.168.2.2
```

---

### NAT(SNAT)

NATはパケットを書き換える技術。主にグローバルIPの節約にSNATが使われる事が多い。

---

### NAT(SNAT)

> 先に書いてもらった自宅NWの図を基にNATを考察する

#### キーワード
- MACアドレス
- 宛先IPアドレス
- 送信元IPアドレス
- ポート

---

### ここまでまとめ
- 僕は唐揚げが好き
- サブネットで決まるもの
- 172.17.10.0/24のブロードキャストアドレス
- ルーティングとは
- ARPとは
- NATとは

---

### DNS

#### Domain Name System

```bash
 % dig pepabo.com  +short
 133.130.34.58
 133.130.34.32
```

---

### DNSの種類

1. 権威サーバ
1. キャッシュサーバ

---

### 権威サーバ

そのサーバ自身がゾーンを管理しているサーバ

---

#### ゾーンとは
DNSにおいてDNSが管理する範囲をゾーンと呼び、__pepabo.com__のような呼称をゾーン名と呼ぶ。

---

### キャッシュサーバ

クライアントからの問合せに応答するサーバ。__再帰検索__によってレコードを検索して応答する。

---

#### 再帰検索

```
$ dig pepabo.com +trace

; <<>> DiG 9.8.3-P1 <<>> pepabo.com +trace
;; global options: +cmd
.                       163940  IN      NS      k.root-servers.net.
〜
;; Received 508 bytes from 192.168.10.1#53(192.168.10.1) in 415 ms

com.                    172800  IN      NS      a.gtld-servers.net.
;; Received 504 bytes from 193.0.14.129#53(193.0.14.129) in 539 ms

pepabo.com.             172800  IN      NS      dns01.muumuu-domain.com.
pepabo.com.             172800  IN      NS      dns02.muumuu-domain.com.
;; Received 114 bytes from 192.43.172.30#53(192.43.172.30) in 184 ms

pepabo.com.             600     IN      A       133.130.34.58
pepabo.com.             600     IN      A       133.130.34.32
;; Received 60 bytes from 202.239.23.40#53(202.239.23.40) in 106 ms
```

> TODO 絵を書いて再帰検索を説明する

---


### Resource Record(RR)
よく利用するRRは下記の通り

- Aレコード
 - 正引き
- CNAMEレコード
 - 別名
- MXレコード
 - メール
- TXTレコード
 - 自由形式
- NSレコード
 - リソースを保持しているネームサーバ
- PTRレコード
 - 逆引き

---

### Whois
ドメインの情報を取得できるデータベースとしてWhoisがある

```
$ whois pepabo.com
```

Whoisデータベースはドメイン管理団体(レジストラ)によって管理されていて、上位のNSレコードも知ることが出来る

---

### digコマンドの使い方

ドメイン周りのデバッグを利用する際に必携。よく使うオプション

- @x.x.x.x
- +trace
- +norec
 - authoritive answer
- +short
- -x

---

### TTL

リソースの有効期限。定義された秒数はキャッシュすることが許容されるが、DNSは実装依存が強いため、安いルーターとかずっとキャッシュしちゃう問題がある。

---

### やっていき

#### dockerを利用してDNSレコードを登録してみる
##### 初期状態

```
$ git clone github.com/pyama86/internet-one
$ cd cloneしたところ
$ ./run_docker
$ dig @localhost example.com
```

---

### やっていき
自分のゾーンを作成し、下記のレコードを登録してみよう

- yourname.com のAレコード
- yourname.com のCNAMEレコード
- yourname.com のMXレコード

> ゾーン定義 ./data/bind/etc/named.conf

---

# おしまい
